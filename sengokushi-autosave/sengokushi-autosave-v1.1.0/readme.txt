Sengokushi AutoSave v1.1.0 / 20210619

以下の文はAHKファイル内の記述を抜き出したものです。
詳細はAHKファイルをメモ帳などのエディタで開いて確認してください。


概要: 戦国史SE, 戦国史FEで「オートセーブ」・「クイックセーブ」・「ワンクリック内政」を行うユーザー操作補助スクリプトです。
また拡張機能として「足軽数が指定数以上の人物は最大まで徴兵する」コマンドを提供します（要118行目の拡張機能有効化）。
使用にはAutoHotkey（以下AHK） v1.1.31以上（ユニコード版）の導入が必要です（v2系は動作保証外）。
スクリプト実行中は、マウスのセンターボタン・サイドボタン1・2、キーボードのF2～F3およびF7～F12、Scroll Lockがゲーム用のキー割り当てに変更されます。
これらのホットキーは戦国史がアクティブな場合に限り、使用できます。非アクティブ化で自動的にオフになります。
Scroll Lock押下、もしくはタスクトレイのアイコンからもサスペンド（ホットキーの無効化）は切り替えできます。
各種設定は54行目から記述されています。

・オートセーブは戦国史がアクティブかつ、ユーザーが一定時間操作をしない場合に行われます。

・オートセーブ、クイックセーブは共通してセーブファイル名は「プレフィクス+スプリッタ文字+YYYYMMDD-HH24MISS」になります。
例えばデフォルトでは、「sengokushi 20210613-201706」のようになります。プレフィクス・スプリッタは変更可能ですが、
上書き保存時以外は日付時刻は強制付与されます。

・ワンクリック内政は、商業開発・新田開発・産業開発・鉄砲生産の4つを実装しています。不要なものはホットキーでoffにできます。

・テストは主に戦国史SE・Windows10下で行っています。環境によっては動作に問題が出る可能性があります。
動作が不正確な場合は141行目の【高度な設定】から`sleepDuration1`の値を増やすことで改善されるかもしれません。

・ホットキーの変更は642行目以降を書き換えてください。
http://ahkwiki.net/KeyList
http://ahkwiki.net/Hotkeys

---------------------------------------------------------------------------------------------------------------------
クイック・リファレンス

マウス
センターボタン: クイックセーブ。
サイドボタン1: 足軽数が指定数以上の人物は最大まで徴兵する（要: 拡張機能有効化）。動作中もう1度押すと中止します。
サイドボタン2: ワンクリック内政。

キーボード
F2: オートセーブの有効/無効切り替え。
F3: 上書きセーブの有効/無効切り替え。
F7: ワンクリック内政の一括有効/無効切り替え。
F8: 商業開発の有効/無効切り替え。
F9: 新田開発の有効/無効切り替え。
F10: 産業開発の有効/無効切り替え。
F11: 鉄砲生産の有効/無効切り替え。
F12: セーブファイルフォルダを開く。
Scroll Lock: サスペンド（ホットキー無効化）の有効/無効の切り替え。

※キーボードのホットキーはF12以外はすべてブール値の切り替えを行うためのみに用意されています。これらの切り替えが不要な場合はすべて削除しても動作します。

--------------------------------------------------------------------------------------------------------------------------------------------------
FAQ

Q.動かない、内政orセーブウィンドウが閉じない。
A.チェック項目（上から順に）
・AutoHotkeyユニコード版 v1.1.31以上が導入されているか（v2系は動作保証外）？
・sleepDuration1の値を大きく増やした場合(1000以上)動作するか？→動作するなら値を徐々に減らす。
・上記2つを試しても改善しない場合、他の環境由来の可能性があります。OSの違いなどによる各種パーツの座標位置のズレなど。
座標位置のズレが原因と特定できる場合、AHK付属の「Window Spy」を使ってウィンドウ上の正しいクライアント座標を取得できます。

Q.「足軽数が指定数以上の人物は最大まで徴兵する」を実行したとき、スクリプトが自動停止しないことがある。
A. 技術的な問題です。リスト下位2人目に到達したときに停止条件を満たしていない場合に起きます。もう一度マウスサイドボタン1を押すことで停止できます。
ゲーム内から取得できる情報だけではリスト位置を把握するのが困難なため、現状放置しています。

--------------------------------------------------------------------------------------------------------------------------------------------------
変更履歴

1.0.0 / 20210614
リリース

1.1.0 / 20210619
・修正: オートセーブ用の内部タイマーがテスト時の極めて短い周期に設定されたままだったので修正（動作には変更なし）。
・変更: CoordModeをClientに変更。OS等の環境の違いによってワンクリック内政等が動作しないかもしれない原因の1つを潰した……つもり。
・変更: 費用対効果の面から内政順序を、商業→新田開発→産業開発（鉱山開発）→鉄砲生産から、商業→産業開発→新田開発→鉄砲生産に変更した。
・変更: マウスセンターボタンによるサスペンドのOn/Offが機能していなかったので廃止し、アクティブウィンドウによる自動判定を最初から有効にした。
　　　　別途サスペンドのホットキーをキーボードのScroll Lockに割り当てた。
・追加: 拡張機能、ワンクリック内政時に不必要なウィンドウを出さない・資金に応じて内政実行の有無を判断するための設定を追加。
・追加: 拡張機能、「足軽数が指定数以上の人物は最大まで徴兵する」コマンドを実装。
・リファクタリング: 設計一部変更。変数名・関数名の一部変更、コメントなどの誤字脱字修正。

-------------------------------------------------------------------------------------------------------------------------------------------------------
@name "Sengokushi AutoSave"
@version "1.1.0 / 20210619"
@author "P-774LSI"
@lisence "CC0"