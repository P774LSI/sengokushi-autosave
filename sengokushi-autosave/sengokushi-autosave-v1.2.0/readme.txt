Sengokushi AutoSave v1.2.0 / 20210703

以下の文はAHKファイル内の記述を抜き出したものです。
詳細はAHKファイルをメモ帳などのエディタで開いて確認してください。


概要: 戦国史SE, 戦国史FEで「オートセーブ」・「クイックセーブ」を行うユーザー操作補助スクリプトです。
また拡張機能として「内政アシスト」・「足軽・城兵を指定数だけ徴兵」・「足軽数が指定数以上の人物はすべて最大まで徴兵」・「兵糧を指定数だけ補充」・「兵糧を最大まで補充」・「軍団資産の初期数値入力」
コマンドを提供します。
使用にはAutoHotkey（以下AHK） v1.1.31以上（ユニコード版）の導入が必要です（v2系は動作保証外）。
スクリプト実行中は、マウスのセンターボタン・サイドボタン1・2、キーボードのF2～F3およびF7～F12、Scroll Lockがゲーム用のキー割り当てに変更されます。
これらのホットキーは戦国史がアクティブな場合に限り、使用できます。非アクティブ化で自動的にオフになります。
Scroll Lock押下、もしくはタスクトレイのアイコンからもサスペンド（ホットキーの無効化）は切り替えできます。
各種設定は59行目から記述されています。

・オートセーブは戦国史がアクティブかつ、ユーザーが一定時間操作をしない場合に行われます。

・オートセーブ、クイックセーブは共通してセーブファイル名は「プレフィクス+スプリッタ文字+YYYYMMDD-HH24MISS」になります。
例えばデフォルトでは、「sengokushi 20210613-201706」のようになります。プレフィクス・スプリッタは変更可能ですが、
上書き保存時以外は日付時刻は強制付与されます。

・内政アシストは、商業開発・新田開発・産業開発・鉄砲生産の4つを実装しています。不要なものはホットキーでoffにできます。

・テストは主に戦国史SE・Windows10下で行っています。環境によっては動作に問題が出る可能性があります。
動作が不正確な場合は220行目の【高度な設定】から`sleepDuration1`の値を増やすことで改善されるかもしれません。

・ホットキーの変更は1017行目以降を書き換えてください。
http://ahkwiki.net/KeyList
http://ahkwiki.net/Hotkeys

---------------------------------------------------------------------------------------------------------------------
クイック・リファレンス

【マウス】
センターボタン: クイックセーブ。
サイドボタン1:  [軍備フェイズ] 徴兵ウィンドウを開いて人物または城を選択した状態で押すと、事前に指定された数の足軽または城兵を徴兵します。
               [軍備フェイズ] 城兵糧補充ウィンドウを開いて城を選択した状態で押すと、事前に定められた数量の兵糧を補充します。
               [軍備フェイズ] 軍団資産ウィンドウを開いた状態で押すと、資金供給・資金徴収・鉄砲支給の入力フォームに事前に定められた数値を入力します。動作中もう1度押すと鉄砲以外はさらに加算されます。
               [内政フェイズ] 内政アシスト。内政フェイズで各サブウィンドウを開く前に押します。
サイドボタン2:  [軍備フェイズ] 徴兵ウィンドウを開いた状態で押すと、足軽数が指定数以上の人物はすべて最大まで徴兵します。動作中もう1度押すと中止します。
               [軍備フェイズ] 城兵糧補充ウィンドウを開いて城を選択した状態で押すと、最大まで兵糧を補充します。


【キーボード】
F2: オートセーブの有効/無効切り替え。
F3: 上書きセーブの有効/無効切り替え。
F7: 内政アシストの一括有効/無効切り替え。
F8: 商業開発の有効/無効切り替え。
F9: 新田開発の有効/無効切り替え。
F10: 産業開発の有効/無効切り替え。
F11: 鉄砲生産の有効/無効切り替え。
F12: セーブファイルフォルダを開く。
Scroll Lock: サスペンド（ホットキー無効化）の有効/無効の切り替え。これはオートサスペンドが無効時の切り替え操作のために用意されています。

※キーボードのホットキーはF12以外はすべてブール値の切り替えを行うためのみに用意されています。これらの切り替えが不要な場合はすべて削除しても動作します。

--------------------------------------------------------------------------------------------------------------------------------------------------
FAQ

Q.動かない、途中で動作が止まる。
A.チェック項目（上から順に）
・AutoHotkeyユニコード版 v1.1.31以上が導入されているか（v2系は動作保証外）？
・sleepDuration1の値を大きく増やした場合(1000以上)に正しく動作するか？→動作するなら値を徐々に減らす。
・上記2つを試しても改善しない場合、個別の環境が原因の可能性があります。OSの違いなどによるボタン等各種パーツの座標位置のズレなど。
座標位置のズレが原因と特定できる場合、AHK付属の「Window Spy」を使ってウィンドウ上の正しいクライアント座標を取得できます。

Q.「足軽数が指定数以上の人物は最大まで徴兵する」を実行したとき、スクリプトが自動停止しないことがある。
A. 技術的な問題です。リスト下位2人目に到達したときに停止条件を満たしていない場合に起きます。もう一度マウスサイドボタン2を押すことで停止できます。
ゲーム内から取得できる情報だけではリスト位置を把握するのが困難なため、現状放置しています。

--------------------------------------------------------------------------------------------------------------------------------------------------
変更履歴

1.0.0 / 20210614
リリース

1.1.0 / 20210619
・修正: オートセーブ用の内部タイマーがテスト時の極めて短い周期に設定されたままだったので修正（動作には変更なし）。
・変更: CoordModeをClientに変更。OS等の環境の違いによってワンクリック内政等が動作しないかもしれない原因の1つを潰した……つもり。
・変更: 費用対効果の面から内政順序を、商業→新田開発→産業開発（鉱山開発）→鉄砲生産から、商業→産業開発→新田開発→鉄砲生産に変更した。
・変更: マウスセンターボタンによるサスペンドのOn/Offが機能していなかったので廃止し、アクティブウィンドウによる自動判定を最初から有効にした。
　　　　別途サスペンドのホットキーをキーボードのScroll Lockに割り当てた。
・追加: 拡張機能、ワンクリック内政時に不必要なウィンドウを出さない・資金に応じて内政実行の有無を判断するための設定を追加。
・追加: 拡張機能、「足軽数が指定数以上の人物は最大まで徴兵する」コマンドを実装。
・リファクタリング: 設計一部変更。変数名・関数名の一部変更、コメントなどの誤字脱字修正。

1.2.0 / 20210703
・変更: コマンドはセーブ系の基本機能と、操作アシスト系の拡張機能に完全分離し、拡張機能はデフォルトで有効にした。
・変更: 新たなコマンド追加に伴い、既存コマンドのボタン割り当てを一部変更。コマンド名も一部変更。
・追加: 事前に指定された数量の足軽または城兵を徴兵する「足軽・城兵を指定数だけ徴兵」を実装。
・追加: 事前に指定された数量の兵糧を補充する「兵糧を指定数だけ補充」を実装。
・追加: 「兵糧を最大まで補充」を実装。
・追加: 資金供給・資金徴収・鉄砲支給の入力フォームに事前に指定された数値を入力する「軍団資産の初期数値入力」を実装。
・リファクタリング: #NoEnv追記、コマンド増加に伴うホットキー周りのコードの整理、フェーズ判定用にdetectPhase()実装、一部変数名変更、一部不要変数・コード削除。一部不適切なコメント修正。
-------------------------------------------------------------------------------------------------------------------------------------------------------
@name "Sengokushi AutoSave"
@version "1.2.0 / 20210703"
@author "P-774LSI / https://github.com/P774LSI/sengokushi-autosave"
@lisence "CC0"
